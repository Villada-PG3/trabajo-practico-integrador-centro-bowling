{% extends 'bowl/navbar.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'bowl/reserva.css' %}">
{% endblock %}

{% block content %}
<div class="hero-section">
    <h1>Reservas de Pistas</h1>
    <p>Visualiza tus reservas y reserva nuevas pistas para disfrutar con tus amigos y familia.</p>
    <a href="{% url 'reserva' %}" class="cta-button">Nueva Reserva</a>
</div>

{% if user.is_authenticated %}
<div class="reserva-form-container">
    <h2>Nueva Reserva</h2>
    <form method="post" action="{% url 'reserva_nueva' %}">
        {% csrf_token %}
        <label for="id_fecha">Fecha:</label>
        <input type="date" name="fecha" id="id_fecha" required>

        <label for="id_hora">Hora:</label>
        <input type="time" name="hora" id="id_hora" required>

        <label for="id_pista">Pista:</label>
        <select name="pista" id="id_pista" required>
            {% for pista in pistas %}
                <option value="{{ pista.id_pista }}">{{ pista.tipo_pista.tipo }} - {{ pista.tipo_pista.zona }}</option>
            {% endfor %}
        </select>

        <button type="submit" class="cta-button">Reservar</button>
    </form>
</div>
{% endif %}

{% if user.is_authenticated and user.rol == "admin" %}
    <div class="reservas-container">
        {% if reservas %}
            {% for reserva in reservas %}
            <div class="reserva-card">
                <h3>Pista: {{ reserva.pista.tipo_pista.tipo }} ({{ reserva.pista.tipo_pista.zona }})</h3>
                <p><strong>Fecha:</strong> {{ reserva.fecha }}</p>
                <p><strong>Hora:</strong> {{ reserva.hora }}</p>
                <p><strong>Precio:</strong> ${{ reserva.precio_total }}</p>
                <p><strong>Estado:</strong> {{ reserva.estado.nombre }}</p>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-reservas">No tienes reservas registradas.</p>
        {% endif %}
    </div>
{% else %}
    <div class="reservas-container">
        {% if reservas %}
            {% for reserva in reservas %}
                {% if reserva.usuario == user %}
                <div class="reserva-card">
                    <h3>Pista: {{ reserva.pista.tipo_pista.tipo }} ({{ reserva.pista.tipo_pista.zona }})</h3>
                    <p><strong>Fecha:</strong> {{ reserva.fecha }}</p>
                    <p><strong>Hora:</strong> {{ reserva.hora }}</p>
                    <p><strong>Precio:</strong> ${{ reserva.precio_total }}</p>
                    <p><strong>Estado:</strong> {{ reserva.estado.nombre }}</p>
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <p class="no-reservas">No tienes reservas registradas.</p>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
